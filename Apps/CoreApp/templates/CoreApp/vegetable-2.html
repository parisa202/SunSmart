<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grouped Bar Chart with D3.js</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>

    
      /* Add your CSS styles here */
      .tooltip {
        position: absolute;
        text-align: center;
        width: 80px;
        height: auto;
        padding: 2px;
        font: 12px sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
      }
    

    /* Add your CSS styles here */
  </style>
</head>
<body>

<h1>Grouped Bar Chart with Error Bars</h1>

<!-- Tooltip container -->
<div class="tooltip" id="tooltip" style="opacity: 0;"></div>

<!-- Age group selection menu -->
<select id="ageGroupSelect">
  <option value="2_3">2-3</option>
  <option value="4_8">4-8</option>
  <option value="9_11">9-11</option>
</select>

<!-- Concern selection menu -->
<select id="concernSelect">
  <option value="Usual daily consumption of fruit">Usual daily consumption of fruit</option>
  <option value="Usual daily consumption of vegetables">Usual daily consumption of vegetables</option>
</select>


<div id="chart-container"></div>

<script>
  // Define your data
  var data = [
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Does not eat fruit", gender: "Male", age_group: "2_3", proportion: 3.4, quality_comment_proportion: "", margin_of_error: 2.3 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Does not eat fruit", gender: "Female", age_group: "2_3", proportion: 5.4, quality_comment_proportion: "", margin_of_error: 1.3 },

    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Less than 1 serve", gender: "Male", age_group: "2_3", proportion: 3.4, quality_comment_proportion: "", margin_of_error: 2.3 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Less than 1 serve", gender: "Female", age_group: "2_3", proportion: 0.6, quality_comment_proportion: "Proportion has a high margin of error and should be used with caution.", margin_of_error: null },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "1 serve", gender: "Persons", age_group: "2_3", proportion: 23.5, quality_comment_proportion: "", margin_of_error: 5.6 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "2 serves", gender: "Persons", age_group: "2_3", proportion: 40.3, quality_comment_proportion: "", margin_of_error: 6.7 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "3 serves", gender: "Male", age_group: "2_3", proportion: 17.8, quality_comment_proportion: "", margin_of_error: 6.0 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "4 serves", gender: "Male", age_group: "2_3", proportion: 11.6, quality_comment_proportion: "", margin_of_error: 5.6 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "5 or more serves", gender: "Female", age_group: "2_3", proportion: 4.7, quality_comment_proportion: "", margin_of_error: 2.8 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Does not eat fruit", gender: "Female", age_group: "4_8", proportion: 1.4, quality_comment_proportion: "", margin_of_error: 0.8 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Less than 1 serve", gender: "Female", age_group: "4_8", proportion: 0.6, quality_comment_proportion: "Proportion has a high margin of error and should be used with caution.", margin_of_error: null },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "1 serve", gender: "Male", age_group: "4_8", proportion: 26.8, quality_comment_proportion: "", margin_of_error: 3.0 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "2 serves", gender: "Male", age_group: "4_8", proportion: 36.4, quality_comment_proportion: "", margin_of_error: 4.7 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "3 serves", gender: "Male", age_group: "4_8", proportion: 23.3, quality_comment_proportion: "", margin_of_error: 3.8 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "4 serves", gender: "Female", age_group: "4_8", proportion: 7.7, quality_comment_proportion: "", margin_of_error: 2.3 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "5 or more serves", gender: "Male", age_group: "4_8", proportion: 2.9, quality_comment_proportion: "", margin_of_error: 1.4 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Does not eat fruit", gender: "Male", age_group: "9_11", proportion: 4.2, quality_comment_proportion: "", margin_of_error: 2.0 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "Less than 1 serve", gender: "Persons", age_group: "9_11", proportion: 1.3, quality_comment_proportion: "Proportion has a high margin of error and should be used with caution.", margin_of_error: null },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "1 serve", gender: "Persons", age_group: "9_11", proportion: 29.1, quality_comment_proportion: "", margin_of_error: 4.3 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "2 serves", gender: "Male", age_group: "9_11", proportion: 38.1, quality_comment_proportion: "", margin_of_error: 5.7 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "3 serves", gender: "Male", age_group: "9_11", proportion: 18.6, quality_comment_proportion: "", margin_of_error: 4.2 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "4 serves", gender: "Female", age_group: "9_11", proportion: 5.0, quality_comment_proportion: "", margin_of_error: 2.5 },
    { year: 2022, concern: "Usual daily consumption of fruit", concern_label: "5 or more serves", gender: "Female", age_group: "9_11", proportion: 2.6, quality_comment_proportion: "", margin_of_error: 1.8 },
  
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "1 serve", gender: "Female", age_group: "9_11", proportion: 12.1, quality_comment_proportion: "", margin_of_error: 4.3 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "2 serves", gender: "Male", age_group: "9_11", proportion: 38.1, quality_comment_proportion: "", margin_of_error: 5.7 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "3 serves", gender: "Male", age_group: "9_11", proportion: 17.6, quality_comment_proportion: "", margin_of_error: 4.2 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "4 serves", gender: "Persons", age_group: "9_11", proportion: 15.0, quality_comment_proportion: "", margin_of_error: 2.5 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "5 or more serves", gender: "Female", age_group: "9_11", proportion: 2.6, quality_comment_proportion: "", margin_of_error: 1.8 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "2 serves", gender: "Female", age_group: "2_3", proportion: 40.3, quality_comment_proportion: "", margin_of_error: 6.7 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "3 serves", gender: "Male", age_group: "2_3", proportion: 17.8, quality_comment_proportion: "", margin_of_error: 6.0 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "4 serves", gender: "Male", age_group: "2_3", proportion: 11.6, quality_comment_proportion: "", margin_of_error: 5.6 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "5 or more serves", gender: "Persons", age_group: "2_3", proportion: 4.7, quality_comment_proportion: "", margin_of_error: 2.8 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "Does not eat fruit", gender: "Persons", age_group: "4_8", proportion: 1.4, quality_comment_proportion: "", margin_of_error: 0.8 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "Less than 1 serve", gender: "Male", age_group: "4_8", proportion: 0.6, quality_comment_proportion: "Proportion has a high margin of error and should be used with caution.", margin_of_error: null },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "1 serve", gender: "Male", age_group: "4_8", proportion: 26.8, quality_comment_proportion: "", margin_of_error: 3.0 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "2 serves", gender: "Male", age_group: "4_8", proportion: 36.4, quality_comment_proportion: "", margin_of_error: 4.7 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "3 serves", gender: "Persons", age_group: "4_8", proportion: 23.3, quality_comment_proportion: "", margin_of_error: 3.8 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "4 serves", gender: "Persons", age_group: "4_8", proportion: 7.7, quality_comment_proportion: "", margin_of_error: 2.3 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "5 or more serves", gender: "Female", age_group: "4_8", proportion: 2.9, quality_comment_proportion: "", margin_of_error: 1.4 },
    { year: 2022, concern: "Usual daily consumption of vegetables", concern_label: "Does not eat fruit", gender: "Female", age_group: "9_11", proportion: 4.2, quality_comment_proportion: "", margin_of_error: 2.0 },
    ];

    // Define SVG dimensions
    var margin = { top: 20, right: 30, bottom: 30, left: 40 };
    var width = 700 - margin.left - margin.right;
    var height = 400 - margin.top - margin.bottom;
  
    // Create SVG container
    var svg = d3.select("#chart-container").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
  
    // Define scales
    var xScale = d3.scaleBand()
      .range([0, width])
      .padding(0.2);
  
    var yScale = d3.scaleLinear()
      .range([height, 0]);
  
    // Define color scale
    var colorScale = d3.scaleOrdinal()
      .range(["blue", "pink"]);
  
    // Define tooltip
    var tooltip = d3.select("#tooltip");
  
    // Function to update the chart
    function updateChart(selectedAgeGroup, selectedConcern) {
      // Filter data based on selected age group and concern
      var filteredData = data.filter(d => d.age_group === selectedAgeGroup && d.concern === selectedConcern);
  
      // Update domains for scales
      xScale.domain(filteredData.map(d => d.concern_label));
      yScale.domain([0, d3.max(filteredData, d => d.proportion)]);
  
      // Update bars for male
      var barsMale = svg.selectAll(".bar-male")
        .data(filteredData.filter(d => d.gender === "Male"));
  
      barsMale.enter().append("rect")
        .attr("class", "bar-male")
        .merge(barsMale)
        .transition()
        .duration(500)
        .attr("x", d => xScale(d.concern_label) - xScale.bandwidth() / 4) // Shift bars to the left
        .attr("y", d => yScale(d.proportion))
        .attr("width", xScale.bandwidth() / 2) // Reduce bar width to accommodate both bars
        .attr("height", d => height - yScale(d.proportion))
        .attr("fill", "blue") // Change color for male bars
        .attr("opacity", 0.8);
  
      barsMale.exit().remove();
  
      // Update bars for female
      var barsFemale = svg.selectAll(".bar-female")
        .data(filteredData.filter(d => d.gender === "Female"));
  
      barsFemale.enter().append("rect")
        .attr("class", "bar-female")
        .merge(barsFemale)
        .transition()
        .duration(500)
        .attr("x", d => xScale(d.concern_label) + xScale.bandwidth() / 4) // Shift bars to the right
        .attr("y", d => yScale(d.proportion))
        .attr("width", xScale.bandwidth() / 2) // Reduce bar width to accommodate both bars
        .attr("height", d => height - yScale(d.proportion))
        .attr("fill", "pink") // Change color for female bars
        .attr("opacity", 0.8);
  
      barsFemale.exit().remove();
  
      // Update axes
      svg.selectAll(".x-axis").remove();
      svg.selectAll(".y-axis").remove();
  
      var xAxis = d3.axisBottom().scale(xScale);
      var yAxis = d3.axisLeft().scale(yScale);
  
      svg.append("g")
        .attr("class", "x-axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);
  
      svg.append("g")
        .attr("class", "y-axis")
        .call(yAxis);
    }
  
    // Call updateChart initially with default values
    updateChart("4_8", "Usual daily consumption of fruit");
  
    // Event listeners for selection change
    d3.select("#ageGroupSelect").on("change", function() {
      var selectedAgeGroup = d3.select(this).property("value");
      var selectedConcern = d3.select("#concernSelect").property("value");
      updateChart(selectedAgeGroup, selectedConcern);
    });
  
    d3.select("#concernSelect").on("change", function() {
      var selectedConcern = d3.select(this).property("value");
      var selectedAgeGroup = d3.select("#ageGroupSelect").property("value");
      updateChart(selectedAgeGroup, selectedConcern);
    });
  </script>
  
  </body>
  </html>